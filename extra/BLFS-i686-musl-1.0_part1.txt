** add "pathappend /usr/lib/pkgconfig PKG_CONFIG_PATH" to /etc/profile.d/extrapaths.sh

##################
# libnl-3.4.0
autoreconf -fi
sed -i '/<linux\/if_bridge.h>/i#define _LINUX_IN6_H' lib/route/link/bridge.c
patch -Np0 -i ../libnl-3.4.0-musl-fix.patch
./configure --prefix=/usr     \
            --sysconfdir=/etc \
            --disable-static  
make && make install

##################
# Linux-PAM-1.3.0
# Use patches from alpine linux
patch -Np1 -i ../Linux-PAM-1.3.0-musl-fix2-libpam.patch
patch -Np1 -i ../Linux-PAM-1.3.0-musl-fix2-compat.patch
patch -Np1 -i ../Linux-PAM-1.3.0-musl-fix2-pam_exec.patch
sed -e 's/pam_rhosts//g' -i modules/Makefile.am
export ac_cv_search_crypt=no
autoreconf -vif
./configure --prefix=/usr                    \
            --sysconfdir=/etc                \
            --libdir=/usr/lib                \
            --disable-regenerate-docu        \
            --enable-securedir=/lib/security \
            --docdir=/usr/share/doc/Linux-PAM-1.3.0 \
            --disable-nis \
            --disable-audit
unset ac_cv_search_crypt
make && make install
chmod -v 4755 /sbin/unix_chkpwd &&

for file in pam pam_misc pamc
do
  mv -v /usr/lib/lib${file}.so.* /lib &&
  ln -sfv ../../lib/$(readlink /usr/lib/lib${file}.so) /usr/lib/lib${file}.so
done
install -vdm755 /etc/pam.d &&
cat > /etc/pam.d/system-account << "EOF" &&
# Begin /etc/pam.d/system-account

account   required    pam_unix.so

# End /etc/pam.d/system-account
EOF

cat > /etc/pam.d/system-auth << "EOF" &&
# Begin /etc/pam.d/system-auth

auth      required    pam_unix.so

# End /etc/pam.d/system-auth
EOF

cat > /etc/pam.d/system-session << "EOF"
# Begin /etc/pam.d/system-session

session   required    pam_unix.so

# End /etc/pam.d/system-session
EOF
cat > /etc/pam.d/system-password << "EOF"
# Begin /etc/pam.d/system-password

# use sha512 hash for encryption, use shadow, and try to use any previously
# defined authentication token (chosen password) set by any prior module
password  required    pam_unix.so       sha512 shadow try_first_pass

# End /etc/pam.d/system-password
EOF
cat > /etc/pam.d/other << "EOF"
# Begin /etc/pam.d/other

auth        required        pam_warn.so
auth        required        pam_deny.so
account     required        pam_warn.so
account     required        pam_deny.so
password    required        pam_warn.so
password    required        pam_deny.so
session     required        pam_warn.so
session     required        pam_deny.so

# End /etc/pam.d/other
EOF
########################
# Shadow-4.5
sed -i 's/groups$(EXEEXT) //' src/Makefile.in &&

find man -name Makefile.in -exec sed -i 's/groups\.1 / /'   {} \; &&
find man -name Makefile.in -exec sed -i 's/getspnam\.3 / /' {} \; &&
find man -name Makefile.in -exec sed -i 's/passwd\.5 / /'   {} \; &&

sed -i -e 's@#ENCRYPT_METHOD DES@ENCRYPT_METHOD SHA512@' \
       -e 's@/var/spool/mail@/var/mail@' etc/login.defs &&

sed -i 's/1000/999/' etc/useradd                           &&

./configure --sysconfdir=/etc --with-group-name-max-length=32 &&
make
make install &&
mv -v /usr/bin/passwd /bin
sed -i 's/yes/no/' /etc/default/useradd
install -v -m644 /etc/login.defs /etc/login.defs.orig &&
for FUNCTION in FAIL_DELAY               \
                FAILLOG_ENAB             \
                LASTLOG_ENAB             \
                MAIL_CHECK_ENAB          \
                OBSCURE_CHECKS_ENAB      \
                PORTTIME_CHECKS_ENAB     \
                QUOTAS_ENAB              \
                CONSOLE MOTD_FILE        \
                FTMP_FILE NOLOGINS_FILE  \
                ENV_HZ PASS_MIN_LEN      \
                SU_WHEEL_ONLY            \
                CRACKLIB_DICTPATH        \
                PASS_CHANGE_TRIES        \
                PASS_ALWAYS_WARN         \
                CHFN_AUTH ENCRYPT_METHOD \
                ENVIRON_FILE
do
    sed -i "s/^${FUNCTION}/# &/" /etc/login.defs
done
cat > /etc/pam.d/login << "EOF"
# Begin /etc/pam.d/login

# Set failure delay before next prompt to 3 seconds
auth      optional    pam_faildelay.so  delay=3000000

# Check to make sure that the user is allowed to login
auth      requisite   pam_nologin.so

# Check to make sure that root is allowed to login
# Disabled by default. You will need to create /etc/securetty
# file for this module to function. See man 5 securetty.
#auth      required    pam_securetty.so

# Additional group memberships - disabled by default
#auth      optional    pam_group.so

# include the default auth settings
auth      include     system-auth

# check access for the user
account   required    pam_access.so

# include the default account settings
account   include     system-account

# Set default environment variables for the user
session   required    pam_env.so

# Set resource limits for the user
session   required    pam_limits.so

# Display date of last login - Disabled by default
#session   optional    pam_lastlog.so

# Display the message of the day - Disabled by default
#session   optional    pam_motd.so

# Check user's mail - Disabled by default
#session   optional    pam_mail.so      standard quiet

# include the default session and password settings
session   include     system-session
password  include     system-password

# End /etc/pam.d/login
EOF
cat > /etc/pam.d/passwd << "EOF"
# Begin /etc/pam.d/passwd

password  include     system-password

# End /etc/pam.d/passwd
EOF
cat > /etc/pam.d/su << "EOF"
# Begin /etc/pam.d/su

# always allow root
auth      sufficient  pam_rootok.so
auth      include     system-auth

# include the default account settings
account   include     system-account

# Set default environment variables for the service user
session   required    pam_env.so

# include system session defaults
session   include     system-session

# End /etc/pam.d/su
EOF
cat > /etc/pam.d/chage << "EOF"
# Begin /etc/pam.d/chage

# always allow root
auth      sufficient  pam_rootok.so

# include system defaults for auth account and session
auth      include     system-auth
account   include     system-account
session   include     system-session

# Always permit for authentication updates
password  required    pam_permit.so

# End /etc/pam.d/chage
EOF
for PROGRAM in chfn chgpasswd chpasswd chsh groupadd groupdel \
               groupmems groupmod newusers useradd userdel usermod
do
    install -v -m644 /etc/pam.d/chage /etc/pam.d/${PROGRAM}
    sed -i "s/chage/$PROGRAM/" /etc/pam.d/${PROGRAM}
done
[ -f /etc/login.access ] && mv -v /etc/login.access{,.NOUSE}
[ -f /etc/limits ] && mv -v /etc/limits{,.NOUSE}
##################
# Sudo-1.8.22
./configure --prefix=/usr              \
            --libexecdir=/usr/lib      \
            --with-secure-path         \
            --with-all-insults         \
            --with-env-editor          \
            --docdir=/usr/share/doc/sudo-1.8.22 \
            --with-passprompt="[sudo] password for %p: " 
make 
make install &&
ln -sfv libsudo_util.so.0.0.0 /usr/lib/sudo/libsudo_util.so.0
cat > /etc/pam.d/sudo << "EOF"
# Begin /etc/pam.d/sudo

# include the default auth settings
auth      include     system-auth

# include the default account settings
account   include     system-account

# Set default environment variables for the service user
session   required    pam_env.so

# include system session defaults
session   include     system-session

# End /etc/pam.d/sudo
EOF
chmod 644 /etc/pam.d/sudo
######################
# ICU-60.2
cd source 
./configure --prefix=/usr 
make && make install
######################
# Libxml2-2.9.7
patch -Np1 -i ../libxml2-2.9.7-python3_hack-1.patch
sed -i '/_PyVerify_fd/,+1d' python/types.c
./configure --prefix=/usr    \
            --disable-static \
            --with-history   \
            --with-python=/usr/bin/python3 \
            --with-icu \
            --with-threads
make && make install
######################
# Xorg-build-setup
export XORG_PREFIX=/opt/xorg7
export XORG_CONFIG="--prefix=$XORG_PREFIX --sysconfdir=/etc \
    --localstatedir=/var --disable-static"
cat > /etc/profile.d/xorg.sh << EOF
XORG_PREFIX="$XORG_PREFIX"
XORG_CONFIG="--prefix=\$XORG_PREFIX --sysconfdir=/etc --localstatedir=/var --disable-static"
export XORG_PREFIX XORG_CONFIG
EOF
chmod 644 /etc/profile.d/xorg.sh
cat >> /etc/profile.d/xorg.sh << "EOF"

pathappend $XORG_PREFIX/bin             PATH
pathappend $XORG_PREFIX/lib/pkgconfig   PKG_CONFIG_PATH
pathappend $XORG_PREFIX/share/pkgconfig PKG_CONFIG_PATH

pathappend $XORG_PREFIX/lib             LIBRARY_PATH
pathappend $XORG_PREFIX/include         C_INCLUDE_PATH
pathappend $XORG_PREFIX/include         CPLUS_INCLUDE_PATH

ACLOCAL="aclocal -I $XORG_PREFIX/share/aclocal"

export PATH PKG_CONFIG_PATH ACLOCAL LIBRARY_PATH C_INCLUDE_PATH CPLUS_INCLUDE_PATH
EOF
echo "$XORG_PREFIX/lib" >> /etc/ld-musl-i386.path
sed "s@/usr/X11R6@$XORG_PREFIX@g" -i /etc/man_db.conf
ln -sf $XORG_PREFIX/share/X11 /usr/share/X11
ln -sf $XORG_PREFIX /usr/X11R6
#######################
# util-macros-1.19.1
./configure $XORG_CONFIG && make install
#######################
# Xorg Protocol Headers
cat > proto-7.md5 << "EOF"
1a05fb01fa1d5198894c931cf925c025  bigreqsproto-1.1.2.tar.bz2
98482f65ba1e74a08bf5b056a4031ef0  compositeproto-0.4.2.tar.bz2
998e5904764b82642cc63d97b4ba9e95  damageproto-1.2.1.tar.bz2
4ee175bbd44d05c34d43bb129be5098a  dmxproto-2.3.1.tar.bz2
b2721d5d24c04d9980a0c6540cb5396a  dri2proto-2.8.tar.bz2
a3d2cbe60a9ca1bf3aea6c93c817fee3  dri3proto-1.0.tar.bz2
e7431ab84d37b2678af71e29355e101d  fixesproto-5.0.tar.bz2
36934d00b00555eaacde9f091f392f97  fontsproto-2.1.3.tar.bz2
5565f1b0facf4a59c2778229c1f70d10  glproto-1.4.17.tar.bz2
b290a463af7def483e6e190de460f31a  inputproto-2.3.2.tar.bz2
94afc90c1f7bef4a27fdd59ece39c878  kbproto-1.0.7.tar.bz2
92f9dda9c870d78a1d93f366bcb0e6cd  presentproto-1.1.tar.bz2
a46765c8dcacb7114c821baf0df1e797  randrproto-1.5.0.tar.bz2
1b4e5dede5ea51906f1530ca1e21d216  recordproto-1.14.2.tar.bz2
a914ccc1de66ddeb4b611c6b0686e274  renderproto-0.11.1.tar.bz2
cfdb57dae221b71b2703f8e2980eaaf4  resourceproto-1.2.0.tar.bz2
edd8a73775e8ece1d69515dd17767bfb  scrnsaverproto-1.2.2.tar.bz2
fe86de8ea3eb53b5a8f52956c5cd3174  videoproto-2.3.3.tar.bz2
5f4847c78e41b801982c8a5e06365b24  xcmiscproto-1.2.2.tar.bz2
70c90f313b4b0851758ef77b95019584  xextproto-7.3.0.tar.bz2
120e226ede5a4687b25dd357cc9b8efe  xf86bigfontproto-1.2.0.tar.bz2
a036dc2fcbf052ec10621fd48b68dbb1  xf86dgaproto-2.1.tar.bz2
1d716d0dac3b664e5ee20c69d34bc10e  xf86driproto-2.1.1.tar.bz2
e793ecefeaecfeabd1aed6a01095174e  xf86vidmodeproto-2.3.1.tar.bz2
9959fe0bfb22a0e7260433b8d199590a  xineramaproto-1.2.1.tar.bz2
16791f7ca8c51a20608af11702e51083  xproto-7.0.31.tar.bz2
EOF
mkdir proto &&
cd proto &&
grep -v '^#' ../proto-7.md5 | awk '{print $2}' | wget -i- -c \
    -B https://www.x.org/pub/individual/proto/ &&
md5sum -c ../proto-7.md5
bash -e
for package in $(grep -v '^#' ../proto-7.md5 | awk '{print $2}')
do
  packagedir=${package%.tar.bz2}
  tar -xf $package
  pushd $packagedir
  ./configure $XORG_CONFIG
  sudo -S porg -lp $packagedir "make -j1 install"
  popd
  rm -rf $packagedir
done
exit

#######################
# libXau-1.0.8
./configure $XORG_CONFIG &&
make && make install

#######################
# libXdmcp-1.1.2
./configure $XORG_CONFIG &&
make && make install

#######################
# SQLite-3.22.0
./configure --prefix=/usr     \
            --disable-static  \
            --enable-fts5     \
            CFLAGS="-g -O2                    \
            -DSQLITE_ENABLE_FTS4=1            \
            -DSQLITE_ENABLE_COLUMN_METADATA=1 \
            -DSQLITE_ENABLE_UNLOCK_NOTIFY=1   \
            -DSQLITE_ENABLE_DBSTAT_VTAB=1     \
            -DSQLITE_SECURE_DELETE=1          \
            -DSQLITE_ENABLE_FTS3_TOKENIZER=1" 
make && make install

#######################
# Python-2.7.14
patch -Np1 -i ../Python-2.7.14-musl-libreSSL-fix2.patch
./configure --prefix=/usr       \
            --enable-shared     \
            --with-system-expat \
            --with-system-ffi   \
            --with-ensurepip=yes \
            --enable-unicode=ucs4
make && make install &&
chmod -v 755 /usr/lib/libpython2.7.so.1.0

#######################
# xcb-proto-1.12
patch -Np1 -i ../xcb-proto-1.12-schema-1.patch
patch -Np1 -i ../xcb-proto-1.12-python3-1.patch
./configure $XORG_CONFIG
make install

#######################
# libxcb-1.12
patch -Np1 -i ../libxcb-1.12-python3-1.patch
sed -i "s/pthread-stubs//" configure 
./configure $XORG_CONFIG      \
            --enable-xinput   \
            --without-doxygen \
            --docdir='${datadir}'/doc/libxcb-1.12
make && make install

######################
# Which-2.21
# sometimes segfaults
./configure --prefix=/usr &&
make && make install
######################
# libpng-1.6.34
gzip -cd ../libpng-1.6.34-apng.patch.gz | patch -p1
LIBS=-lpthread ./configure --prefix=/usr --disable-static &&
make && make install

#####################
# FreeType-2.9
sed -ri "s:.*(AUX_MODULES.*valid):\1:" modules.cfg &&

sed -r "s:.*(#.*SUBPIXEL_RENDERING) .*:\1:" \
    -i include/freetype/config/ftoption.h  &&

./configure --prefix=/usr --disable-static &&
make && make install
#####################
# PCRE-8.41
./configure --prefix=/usr                     \
            --docdir=/usr/share/doc/pcre-8.41 \
            --enable-unicode-properties       \
            --enable-pcre16                   \
            --enable-pcre32                   \
            --enable-pcregrep-libz            \
            --enable-pcregrep-libbz2          \
            --enable-pcretest-libreadline     \
            --disable-static \
            --enable-jit
make && make install                     &&
mv -v /usr/lib/libpcre.so.* /lib &&
ln -sfv ../../lib/$(readlink /usr/lib/libpcre.so) /usr/lib/libpcre.so
#########################
# argp standalone -1.3
CFLAGS=" -fPIC" ./configure --prefix=/usr --disable-static
make 
cp -v libargp.a /usr/lib/
cp -v argp.h /usr/include/

#########################
# Musl-obstack-1.1
sed -i "/pkgconfig_DATA/i pkgconfigdir=/usr/lib/pkgconfig" Makefile.am
./bootstrap.sh
./configure --prefix=/usr
make & make install

##########################
# Musl-fts-1.2.7
sed -i "/pkgconfig_DATA/i pkgconfigdir=/usr/lib/pkgconfig" Makefile.am
./bootstrap.sh
./configure --prefix=/usr
make & make install

########################
# libelf-0.170
# needs musl-{obstack,fts} and argp-standalone
# removed libelf-compat before install
patch -Np1 -i ../elfutils-0.170-musl-voidfixes-1.patch 
cp -v ../elfutils-0.170-missingfile-error.h lib/error.h
cp -v ../elfutils-0.170-missingfile-error.h src/error.h
autoreconf -if
CFLAGS="-Wno-error" \
./configure --prefix=/usr
make && make install

####################
# GLib-2.56.1
patch -Np1 -i ../glib-2.56.1-skip_warnings-1.patch
./configure --prefix=/usr      \
            --with-pcre=system \
            --with-python=/usr/bin/python3 
make && make install

###################
# Pkg-config-0.29.2
./configure --prefix=/usr              \
            --disable-host-tool        \
            --docdir=/usr/share/doc/pkg-config-0.29.2
make && make install

########################
# libuv-1.22.0
sh autogen.sh                              &&
./configure --prefix=/usr --disable-static &&
make && make install

####################
# Nettle-3.4
./configure --prefix=/usr --disable-static 
make && make install &&
chmod   -v   755 /usr/lib/lib{hogweed,nettle}.so &&
install -v -m755 -d /usr/share/doc/nettle-3.4 &&
install -v -m644 nettle.html /usr/share/doc/nettle-3.4

#####################
# LZO-2.10
./configure --prefix=/usr                    \
            --enable-shared                  \
            --disable-static                 \
            --docdir=/usr/share/doc/lzo-2.10 &&
make && make install

#####################
# libarchive-3.3.2
./configure --prefix=/usr --disable-static &&
make && make install

#####################
# libtasn1-4.13
./configure --prefix=/usr --disable-static &&
make && make install

#####################
# NSPR-4.19
cd nspr                                                     &&
sed -ri 's#^(RELEASE_BINS =).*#\1#' pr/src/misc/Makefile.in &&
sed -i 's#$(LIBRARY) ##'            config/rules.mk         &&

./configure --prefix=/usr \
            --with-mozilla \
            --with-pthreads \
            $([ $(uname -m) = x86_64 ] && echo --enable-64bit)
make && make install

####################
# NSS-3.37.3
patch -Np1 -i ../nss-3.37.3-standalone-1.patch &&
cd nss &&
make -j1 BUILD_OPT=1                  \
  NSPR_INCLUDE_DIR=/usr/include/nspr  \
  USE_SYSTEM_ZLIB=1                   \
  ZLIB_LIBS=-lz                       \
  NSS_ENABLE_WERROR=0                 \
  $([ $(uname -m) = x86_64 ] && echo USE_64=1) \
  $([ -f /usr/include/sqlite3.h ] && echo NSS_USE_SYSTEM_SQLITE=1)
cd ../dist                                                          &&
install -v -m755 Linux*/lib/*.so              /usr/lib              &&
install -v -m644 Linux*/lib/{*.chk,libcrmf.a} /usr/lib              &&
install -v -m755 -d                           /usr/include/nss      &&
cp -v -RL {public,private}/nss/*              /usr/include/nss      &&
chmod -v 644                                  /usr/include/nss/*    &&
install -v -m755 Linux*/bin/{certutil,nss-config,pk12util} /usr/bin &&
install -v -m644 Linux*/lib/pkgconfig/nss.pc  /usr/lib/pkgconfig


# make-ca-0.8
make install
# SSL certs not made...research!

#####################
# p11-kit-0.23.12
./configure --prefix=/usr     \
            --sysconfdir=/etc \
            --with-trust-paths=/etc/pki/anchors &&
make && make install

#####################
# c-ares-1.14.0
./configure --prefix=/usr --disable-static &&
make && make install

#####################
# libunistring-0.9.10
./configure --prefix=/usr    \
            --disable-static \
            --docdir=/usr/share/doc/libunistring-0.9.10 &&
make && make install

#####################
# libidn2-2.0.5
./configure --prefix=/usr --disable-static &&
make &7 make install

####################
# GnuTLS-3.5.18
./configure --prefix=/usr \
            --with-default-trust-store-pkcs11="pkcs11:" &&
make && make install

###################
# libgpg-error-1.31
./configure --prefix=/usr &&
make && make install

###################
# libgcrypt-1.8.3
./configure --prefix=/usr &&
make && make install

###################
# libedit-20180525-3.1
./configure --prefix=/usr
make && make install

####################
# OpenSSH-7.7p1
install  -v -m700 -d /var/lib/sshd &&
chown    -v root:sys /var/lib/sshd &&

groupadd -g 50 sshd        &&
useradd  -c 'sshd PrivSep' \
         -d /var/lib/sshd  \
         -g sshd           \
         -s /bin/false     \
         -u 50 sshd
patch -Np1 -i ../openssh-7.7p1-alpine-bsd-comp.patch
patch -Np1 -i ../openssh-7.7p1-alpine-sftp-inter.patch
patch -Np1 -i ../openssh-7.7p1-alpine-utmp.patch
./configure --prefix=/usr                     \
            --sysconfdir=/etc/ssh             \
            --with-md5-passwords              \
            --with-privsep-path=/var/lib/sshd \
            --with-pam \
            --with-xauth=/usr/bin/xauth \
            --with-libedit \
            --without-rpath \
            --with-ssl-engine \
            --disable-wtmp \
            --disable-utmp  &&
make && make install &&
install -v -m755    contrib/ssh-copy-id /usr/bin     &&
install -v -m644    contrib/ssh-copy-id.1 \
                    /usr/share/man/man1              &&
install -v -m755 -d /usr/share/doc/openssh-7.7p1     &&
install -v -m644    INSTALL LICENCE OVERVIEW README* \
                    /usr/share/doc/openssh-7.7p1

####################
# libssh2-1.8.0
./configure --prefix=/usr --disable-static &&
make && make install

###################
# cURL-7.60.0
patch -Np1 -i ../curl-7.60.0-libressl-fix-1.patch &&
patch -Np1 -i ../curl-7.60.0-libressl-fix-2.patch 
./configure --prefix=/usr                           \
            --disable-static                        \
            --enable-threaded-resolver              \
            --with-ca-path=/etc/ssl/certs \
            --without-ssl --with-gnutls \
            --with-libssh2 \
            --enable-ipv6 \
            --enable-unix-sockets --with-pic &&
make && make install

###################
# CMake-3.11.4
sed -i '/"lib64"/s/64//' Modules/GNUInstallDirs.cmake &&
patch -Np1 -i ../cmake-3.11.4-find-libuv.patch
./bootstrap --prefix=/usr        \
            --system-libs        \
            --mandir=/share/man  \
            --no-system-jsoncpp  \
            --no-system-librhash \
            --docdir=/share/doc/cmake-3.11.4 &&
make && make install

###################
# Graphite2-1.3.11
sed -i '/cmptest/d' tests/CMakeLists.txt
mkdir build &&
cd    build &&

cmake -DCMAKE_INSTALL_PREFIX=/usr .. &&
make && make install

##################
# gobject-introspection-1.56.1
./configure --prefix=/usr    \
            --disable-static \
            --with-python=/usr/bin/python3 &&
make && make install

##################
# HarfBuzz-1.8.1
patch -Np1 -i ../harfbuzz-1.8.1-test_fix-1.patch
./configure --prefix=/usr \
            --with-gobject \
            --with-graphite2 &&
make && make install

#################
# FreeType-2.9.1
sed -ri "s:.*(AUX_MODULES.*valid):\1:" modules.cfg &&

sed -r "s:.*(#.*SUBPIXEL_RENDERING) .*:\1:" \
    -i include/freetype/config/ftoption.h  &&

./configure --prefix=/usr --enable-freetype-config --disable-static &&
make && make install
#will not compile after harfuzz... recompile with cmake:
#mkdir built-ft &&
#cmake -DCMAKE_INSTALL_PREFIX:PATH=/usr -DCMAKE_BUILD_TYPE=Release ..

#################
# Fontconfig-2.13.0
# fix freetype2.pc:
# Requires.private: zlib, libpng, harfbuzz
# Libs: -L${libdir} -lfreetype
# Libs.private: -lbz2
#
# rebuild libpng? no change
# restored freetype without harfuzz

rm -vf src/fcobjshash.h
./configure --prefix=/usr        \
            --sysconfdir=/etc    \
            --localstatedir=/var \
            --disable-docs       \
            --docdir=/usr/share/doc/fontconfig-2.13.0 &&
make && make install


#################
# Xorg libraries
cat > lib-7.md5 << "EOF"
c5ba432dd1514d858053ffe9f4737dd8  xtrans-1.3.5.tar.bz2
0f618db70c4054ca67cee0cc156a4255  libX11-1.6.5.tar.bz2
52df7c4c1f0badd9f82ab124fb32eb97  libXext-1.3.3.tar.bz2
d79d9fe2aa55eb0f69b1a4351e1368f7  libFS-1.0.7.tar.bz2
addfb1e897ca8079531669c7c7711726  libICE-1.0.9.tar.bz2
499a7773c65aba513609fe651853c5f3  libSM-1.2.2.tar.bz2
7a773b16165e39e938650bcc9027c1d5  libXScrnSaver-1.2.2.tar.bz2
8f5b5576fbabba29a05f3ca2226f74d3  libXt-1.1.5.tar.bz2
41d92ab627dfa06568076043f3e089e4  libXmu-1.1.2.tar.bz2
20f4627672edb2bd06a749f11aa97302  libXpm-3.5.12.tar.bz2
e5e06eb14a608b58746bdd1c0bd7b8e3  libXaw-1.0.13.tar.bz2
07e01e046a0215574f36a3aacb148be0  libXfixes-5.0.3.tar.bz2
f7a218dcbf6f0848599c6c36fc65c51a  libXcomposite-0.4.4.tar.bz2
802179a76bded0b658f4e9ec5e1830a4  libXrender-0.9.10.tar.bz2
58fe3514e1e7135cf364101e714d1a14  libXcursor-1.1.15.tar.bz2
0cf292de2a9fa2e9a939aefde68fd34f  libXdamage-1.1.4.tar.bz2
0920924c3a9ebc1265517bdd2f9fde50  libfontenc-1.1.3.tar.bz2
b7ca87dfafeb5205b28a1e91ac3efe85  libXfont2-2.0.3.tar.bz2
331b3a2a3a1a78b5b44cfbd43f86fcfe  libXft-2.3.2.tar.bz2
1f0f2719c020655a60aee334ddd26d67  libXi-1.7.9.tar.bz2
9336dc46ae3bf5f81c247f7131461efd  libXinerama-1.1.3.tar.bz2
28e486f1d491b757173dd85ba34ee884  libXrandr-1.5.1.tar.bz2
5d6d443d1abc8e1f6fc1c57fb27729bb  libXres-1.2.0.tar.bz2
ef8c2c1d16a00bd95b9fdcef63b8a2ca  libXtst-1.2.3.tar.bz2
210b6ef30dda2256d54763136faa37b9  libXv-1.0.11.tar.bz2
4cbe1c1def7a5e1b0ed5fce8e512f4c6  libXvMC-1.0.10.tar.bz2
d7dd9b9df336b7dd4028b6b56542ff2c  libXxf86dga-1.1.4.tar.bz2
298b8fff82df17304dfdb5fe4066fe3a  libXxf86vm-1.1.4.tar.bz2
d2f1f0ec68ac3932dd7f1d9aa0a7a11c  libdmx-1.1.4.tar.bz2
8f436e151d5106a9cfaa71857a066d33  libpciaccess-0.14.tar.bz2
4a4cfeaf24dab1b991903455d6d7d404  libxkbfile-1.0.9.tar.bz2
42dda8016943dc12aff2c03a036e0937  libxshmfence-1.3.tar.bz2
EOF
mkdir lib &&
cd lib &&
grep -v '^#' ../lib-7.md5 | awk '{print $2}' | wget -i- -c \
    -B https://www.x.org/pub/individual/lib/ &&
md5sum -c ../lib-7.md5
bash -e 
for package in $(grep -v '^#' ../lib-7.md5 | awk '{print $2}')
do
  packagedir=${package%.tar.bz2}
  tar -xf $package
  pushd $packagedir
  case $packagedir in
    libICE* )
      ./configure $XORG_CONFIG ICE_LIBS=-lpthread
    ;;

    libXfont2-[0-9]* )
      ./configure $XORG_CONFIG --disable-devel-docs
    ;;

    libXt-[0-9]* )
      ./configure $XORG_CONFIG \
                  --with-appdefaultdir=/etc/X11/app-defaults
    ;;

    * )
      ./configure $XORG_CONFIG
    ;;
  esac
  make -j2
  #make check 2>&1 | tee ../$packagedir-make_check.log
  sudo -S porg -lp $packagedir "make -j1 install"
  popd
  rm -rf $packagedir
  #as_root /sbin/ldconfig
done
ln -sv $XORG_PREFIX/lib/X11 /usr/lib/X11 &&
ln -sv $XORG_PREFIX/include/X11 /usr/include/X11

###################
# Unzip 6.0
make -f unix/Makefile generic
make prefix=/usr MANDIR=/usr/share/man/man1 \
 -f unix/Makefile install

###################
# sgml-common-0.6.3
patch -Np1 -i ../sgml-common-0.6.3-manpage-1.patch &&
autoreconf -f -i
./configure --prefix=/usr --sysconfdir=/etc &&
make && make install

###################
# Docbook-xml-4.5
install -v -d -m755 /usr/share/xml/docbook/xml-dtd-4.5 &&
install -v -d -m755 /etc/xml &&
chown -R root:root . &&
cp -v -af docbook.cat *.dtd ent/ *.mod \
    /usr/share/xml/docbook/xml-dtd-4.5
if [ ! -e /etc/xml/docbook ]; then
    xmlcatalog --noout --create /etc/xml/docbook
fi &&
xmlcatalog --noout --add "public" \
    "-//OASIS//DTD DocBook XML V4.5//EN" \
    "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" \
    /etc/xml/docbook &&
xmlcatalog --noout --add "public" \
    "-//OASIS//DTD DocBook XML CALS Table Model V4.5//EN" \
    "file:///usr/share/xml/docbook/xml-dtd-4.5/calstblx.dtd" \
    /etc/xml/docbook &&
xmlcatalog --noout --add "public" \
    "-//OASIS//DTD XML Exchange Table Model 19990315//EN" \
    "file:///usr/share/xml/docbook/xml-dtd-4.5/soextblx.dtd" \
    /etc/xml/docbook &&
xmlcatalog --noout --add "public" \
    "-//OASIS//ELEMENTS DocBook XML Information Pool V4.5//EN" \
    "file:///usr/share/xml/docbook/xml-dtd-4.5/dbpoolx.mod" \
    /etc/xml/docbook &&
xmlcatalog --noout --add "public" \
    "-//OASIS//ELEMENTS DocBook XML Document Hierarchy V4.5//EN" \
    "file:///usr/share/xml/docbook/xml-dtd-4.5/dbhierx.mod" \
    /etc/xml/docbook &&
xmlcatalog --noout --add "public" \
    "-//OASIS//ELEMENTS DocBook XML HTML Tables V4.5//EN" \
    "file:///usr/share/xml/docbook/xml-dtd-4.5/htmltblx.mod" \
    /etc/xml/docbook &&
xmlcatalog --noout --add "public" \
    "-//OASIS//ENTITIES DocBook XML Notations V4.5//EN" \
    "file:///usr/share/xml/docbook/xml-dtd-4.5/dbnotnx.mod" \
    /etc/xml/docbook &&
xmlcatalog --noout --add "public" \
    "-//OASIS//ENTITIES DocBook XML Character Entities V4.5//EN" \
    "file:///usr/share/xml/docbook/xml-dtd-4.5/dbcentx.mod" \
    /etc/xml/docbook &&
xmlcatalog --noout --add "public" \
    "-//OASIS//ENTITIES DocBook XML Additional General Entities V4.5//EN" \
    "file:///usr/share/xml/docbook/xml-dtd-4.5/dbgenent.mod" \
    /etc/xml/docbook &&
xmlcatalog --noout --add "rewriteSystem" \
    "http://www.oasis-open.org/docbook/xml/4.5" \
    "file:///usr/share/xml/docbook/xml-dtd-4.5" \
    /etc/xml/docbook &&
xmlcatalog --noout --add "rewriteURI" \
    "http://www.oasis-open.org/docbook/xml/4.5" \
    "file:///usr/share/xml/docbook/xml-dtd-4.5" \
    /etc/xml/docbook
if [ ! -e /etc/xml/catalog ]; then
    xmlcatalog --noout --create /etc/xml/catalog
fi &&
xmlcatalog --noout --add "delegatePublic" \
    "-//OASIS//ENTITIES DocBook XML" \
    "file:///etc/xml/docbook" \
    /etc/xml/catalog &&
xmlcatalog --noout --add "delegatePublic" \
    "-//OASIS//DTD DocBook XML" \
    "file:///etc/xml/docbook" \
    /etc/xml/catalog &&
xmlcatalog --noout --add "delegateSystem" \
    "http://www.oasis-open.org/docbook/" \
    "file:///etc/xml/docbook" \
    /etc/xml/catalog &&
xmlcatalog --noout --add "delegateURI" \
    "http://www.oasis-open.org/docbook/" \
    "file:///etc/xml/docbook" \
    /etc/xml/catalog
for DTDVERSION in 4.1.2 4.2 4.3 4.4
do
  xmlcatalog --noout --add "public" \
    "-//OASIS//DTD DocBook XML V$DTDVERSION//EN" \
    "http://www.oasis-open.org/docbook/xml/$DTDVERSION/docbookx.dtd" \
    /etc/xml/docbook
  xmlcatalog --noout --add "rewriteSystem" \
    "http://www.oasis-open.org/docbook/xml/$DTDVERSION" \
    "file:///usr/share/xml/docbook/xml-dtd-4.5" \
    /etc/xml/docbook
  xmlcatalog --noout --add "rewriteURI" \
    "http://www.oasis-open.org/docbook/xml/$DTDVERSION" \
    "file:///usr/share/xml/docbook/xml-dtd-4.5" \
    /etc/xml/docbook
  xmlcatalog --noout --add "delegateSystem" \
    "http://www.oasis-open.org/docbook/xml/$DTDVERSION/" \
    "file:///etc/xml/docbook" \
    /etc/xml/catalog
  xmlcatalog --noout --add "delegateURI" \
    "http://www.oasis-open.org/docbook/xml/$DTDVERSION/" \
    "file:///etc/xml/docbook" \
    /etc/xml/catalog
done

######################
# docbook-xsl-1.79.2
patch -Np1 -i ../docbook-xsl-1.79.2-stack_fix-1.patch
install -v -m755 -d /usr/share/xml/docbook/xsl-stylesheets-1.79.2 &&

cp -v -R VERSION assembly common eclipse epub epub3 extensions fo        \
         highlighting html htmlhelp images javahelp lib manpages params  \
         profiling roundtrip slides template tests tools webhelp website \
         xhtml xhtml-1_1 xhtml5                                          \
    /usr/share/xml/docbook/xsl-stylesheets-1.79.2 &&

ln -s VERSION /usr/share/xml/docbook/xsl-stylesheets-1.79.2/VERSION.xsl &&

install -v -m644 -D README \
                    /usr/share/doc/docbook-xsl-1.79.2/README.txt &&
install -v -m644    RELEASE-NOTES* NEWS* \
                    /usr/share/doc/docbook-xsl-1.79.2
if [ ! -d /etc/xml ]; then install -v -m755 -d /etc/xml; fi &&
if [ ! -f /etc/xml/catalog ]; then
    xmlcatalog --noout --create /etc/xml/catalog
fi &&

xmlcatalog --noout --add "rewriteSystem" \
           "http://docbook.sourceforge.net/release/xsl/1.79.2" \
           "/usr/share/xml/docbook/xsl-stylesheets-1.79.2" \
    /etc/xml/catalog &&

xmlcatalog --noout --add "rewriteURI" \
           "http://docbook.sourceforge.net/release/xsl/1.79.2" \
           "/usr/share/xml/docbook/xsl-stylesheets-1.79.2" \
    /etc/xml/catalog &&

xmlcatalog --noout --add "rewriteSystem" \
           "http://docbook.sourceforge.net/release/xsl/current" \
           "/usr/share/xml/docbook/xsl-stylesheets-1.79.2" \
    /etc/xml/catalog &&

xmlcatalog --noout --add "rewriteURI" \
           "http://docbook.sourceforge.net/release/xsl/current" \
           "/usr/share/xml/docbook/xsl-stylesheets-1.79.2" \
    /etc/xml/catalog

#################
# libxslt-1.1.32
sed -i s/3000/5000/ libxslt/transform.c doc/xsltproc.{1,xml} &&
./configure --prefix=/usr --disable-static                   &&
make && make install

################
# xmlto-0.0.28
LINKS="/usr/bin/links" \
./configure --prefix=/usr &&
make && make install

###################
# dbus-1.12.8
# configuration needs xlmto
groupadd -g 18 messagebus &&
useradd -c "D-Bus Message Daemon User" -d /var/run/dbus \
        -u 18 -g messagebus -s /bin/false messagebus
./configure --prefix=/usr \
            --sysconfdir=/etc \
            --localstatedir=/var \
            --docdir=/usr/share/doc/dbus-1.12.8 \
            --disable-selinux \
            --enable-inotify \
            --with-dbus-user=messagebus \
            --enable-xml-docs \
            --disable-static \
            --disable-tests \
            --enable-epoll \
            --disable-asserts \
            --disable-systemd \
            --with-system-socket=/run/dbus/system_bus_socket \
            --disable-doxygen-docs \
            --with-system-pid-file=/run/dbus/pid \
            --with-console-auth-dir=/run/console \
            --disable-user-session
make && make install
#if still in chroot:
# dbus-uuidgen --ensure
mkdir -vp /etc/sv/dbus
cat > /etc/sv/dbus/run << "EOF"
#!/bin/bash
[ -e /run/dbus/pid ] && rm /run/dbus/pid
[ ! -d /run/dbus ] && install -m755 -g 18 -o 18 -d /run/dbus
/usr/bin/dbus-uuidgen --ensure
/usr/bin/dbus-daemon --system --nofork --nopidfile
EOF
cat > /etc/sv/dbus/check << "EOF"
#!/bin/sh
exec dbus-send --system / org.freedesktop.DBus.Peer.Ping > /dev/null 2> /dev/null
EOF
chmod -v a+x /etc/sv/dbus/*
ln -sv /etc/sv/dbus /etc/runit/runsvdir/multi/

#######################
# wpa_supplicant-2.6
cat > wpa_supplicant/.config << "EOF"
CONFIG_BACKEND=file
CONFIG_CTRL_IFACE=y
CONFIG_DEBUG_FILE=y
CONFIG_DEBUG_SYSLOG=y
CONFIG_DEBUG_SYSLOG_FACILITY=LOG_DAEMON
CONFIG_DRIVER_NL80211=y
CONFIG_DRIVER_WEXT=y
CONFIG_DRIVER_WIRED=y
CONFIG_EAP_GTC=y
CONFIG_EAP_LEAP=y
CONFIG_EAP_MD5=y
CONFIG_EAP_MSCHAPV2=y
CONFIG_EAP_OTP=y
CONFIG_EAP_PEAP=y
CONFIG_EAP_TLS=y
CONFIG_EAP_TTLS=y
CONFIG_IEEE8021X_EAPOL=y
CONFIG_IPV6=y
CONFIG_LIBNL32=y
CONFIG_PEERKEY=y
CONFIG_PKCS12=y
CONFIG_READLINE=y
CONFIG_SMARTCARD=y
CONFIG_WPS=y
CFLAGS += -I/usr/include/libnl3
EOF
cat >> wpa_supplicant/.config << "EOF"
CONFIG_CTRL_IFACE_DBUS=y
CONFIG_CTRL_IFACE_DBUS_NEW=y
CONFIG_CTRL_IFACE_DBUS_INTRO=y
EOF
patch -p1 -i ../wpa_supplicant-2.6-upstream_fixes-1.patch &&
patch -p1 -i ../wpa_supplicant-2.6-libressl.patch &&
cd wpa_supplicant                                         &&
make BINDIR=/sbin LIBDIR=/lib
install -v -m755 wpa_{cli,passphrase,supplicant} /sbin/ &&
install -v -m644 doc/docbook/wpa_supplicant.conf.5 /usr/share/man/man5/ &&
install -v -m644 doc/docbook/wpa_{cli,passphrase,supplicant}.8 /usr/share/man/man8/
install -v -m644 dbus/fi.{epitest.hostap.WPASupplicant,w1.wpa_supplicant1}.service \
                 /usr/share/dbus-1/system-services/ &&
install -v -d -m755 /etc/dbus-1/system.d &&
install -v -m644 dbus/dbus-wpa_supplicant.conf \
                 /etc/dbus-1/system.d/wpa_supplicant.conf
#go to runit-for-lfs, so wireless runs at boot
#cd blfs-servicescripts
#make install-service-wpa

#################
# libevent-2.1.8
patch -Np0 -i ../libevent-2.1.8-stable-fix-libressl.patch
./configure --prefix=/usr --disable-static &&
make

#################
# ntp-4.2.8p11
groupadd -g 87 ntp 
useradd -c "Network Time Protocol" -d /var/lib/ntp -u 87 \
        -g ntp -s /bin/false ntp
sed -e 's/"(\\S+)"/"?([^\\s"]+)"?/' \
    -i scripts/update-leap/update-leap.in
./configure CFLAGS="-O2 -g -fPIC" \
            --prefix=/usr         \
            --bindir=/usr/sbin    \
            --sysconfdir=/etc     \
            --enable-linuxcaps    \
            --with-lineeditlibs=readline \
            --docdir=/usr/share/doc/ntp-4.2.8p11 
make && make install &&
install -v -o ntp -g ntp -d /var/lib/ntp

################
# dhcpcd-7.0.6
./configure --prefix=/usr \
            --sbindir=/usr/bin \
            --sysconfdir=/etc \
            --rundir=/run
make 
sed -i 's,-B,& -s,' hooks/10-wpa_supplicant
make install
mv /usr/bin/dhcpcd /sbin/dhcpcd
#go to runit-for-lfs, so wireless runs at boot
#cd blfs-servicescripts
#make install-service-dhcpcd

##################
# xcb-util-0.4.0
./configure $XORG_CONFIG &&
make && make install

#################
# xcb-util-image-0.4.0
./configure $XORG_CONFIG &&
make && make install

#################
# xcb-util-keysyms-0.4.0
./configure $XORG_CONFIG &&
make && make install

###########################
# xcb-util-renderutil-0.3.9
./configure $XORG_CONFIG &&
make && make install

###########################
# xcb-util-wm-0.4.1
./configure $XORG_CONFIG &&
make && make install

###########################
# xcb-util-cursor-0.1.3
./configure $XORG_CONFIG &&
make && make install

###########################
# libpciaccess-0.14
./configure --prefix=/opt/xorg7 \
            --sysconfdir=/etc \
            --localstatedir=/var \
            --disable-static

###########################
# libdrm-2.4.92
# will not compile with meson & ninja because of missing symbols:
# /usr/bin/ld: warning: libpciaccess.so.0, needed by intel/libdrm_intel.so.1.0.0, not found (try using -rpath or -rpath-link)
#intel/libdrm_intel.so.1.0.0: undefined reference to `pci_device_probe'
patch -Np1 -i ../libdrm-2.4.92-void-no-noveau-tests.patch
./configure --prefix=${XORG_PREFIX} \
            --enable-udev
make && make install

###########################
# funcsigs-1.0.2
python setup.py install --optimize=1

###########################
# Beaker-1.9.1
python setup.py install --optimize=1
python3 setup.py install --optimize=1

###########################
# MarkupSafe-1.0
python setup.py build
python setup.py install --optimize=1
python3 setup.py build
python3 setup.py install --optimize=1

###########################
# Mako-1.0.4
python setup.py install --optimize=1
sed -i "s:mako-render:&3:g" setup.py &&
python3 setup.py install --optimize=1

##########################
# libvdpau-1.1.1
./configure $XORG_CONFIG \
            --docdir=/usr/share/doc/libvdpau-1.1.1 &&
make && make install

##########################
# Wayland-1.15.0
./configure --prefix=/usr    \
            --disable-static \
            --disable-documentation &&
make && make install

#########################
# Wayland-Protocols-1.14
./configure --prefix=/usr &&
make && make install

##########################
# LLVM-6.0.0
patch -Np1 -i ../llvm-6.0.0.src-void-musl-fix.patch
tar -xf ../cfe-6.0.0.src.tar.xz 
cd cfe-6.0.0.src &&
patch -Np1 -i ../../cfe-6.0.0.src-void-musl-triples.patch &&
patch -Np1 -i ../../cfe-6.0.0.src-void-fix-stdint.patch &&
patch -Np1 -i ../../cfe-6.0.0.src-void-fix-unwind.patch &&
cd ..
mv -v cfe-6.0.0.src tools
tar -xf ../compiler-rt-6.0.0.src.tar.xz -C projects &&
mv -v tools/cfe-6.0.0.src tools/clang &&
mv -v projects/compiler-rt-6.0.0.src projects/compiler-rt
sed -i 's/set(COMPILER_RT_HAS_SANITIZER_COMMON TRUE)/set(COMPILER_RT_HAS_SANITIZER_COMMON FALSE)/'  projects/compiler-rt/cmake/config-ix.cmake
mkdir -v build &&
cd       build &&

CC=gcc CXX=g++                              \
cmake -DCMAKE_INSTALL_PREFIX=/usr           \
      -DLLVM_ENABLE_FFI=ON                  \
      -DCMAKE_BUILD_TYPE=Release            \
      -DLLVM_BUILD_LLVM_DYLIB=ON            \
      -DLLVM_LINK_LLVM_DYLIB=ON             \
      -DLLVM_TARGETS_TO_BUILD="host;AMDGPU;X86" \
      -DLLVM_INSTALL_UTILS=ON \
      -DLLVM_ENABLE_RTTI=ON \
      -DLLVM_BINUTILS_INCDIR=/usr/include \
      -Wno-dev ..                           &&
make && make install

#####################
# Mesa-18.1.4
# add "#include<time.h>" to src/mesa/drivers/dri/i965/brw_bufmgr.h
patch -Np0 -i ../mesa-18.1.4-void-musl-endian.patch
patch -Np0 -i ../mesa-18.1.4-void-musl.patch
export GLL_DRV="i915,nouveau,radeonsi,svga,swrast"
./configure CFLAGS='-O2' CXXFLAGS='-O2' LDFLAGS=-lLLVM \
            --prefix=$XORG_PREFIX              \
            --sysconfdir=/etc                  \
            --enable-texture-float             \
            --enable-osmesa                    \
            --enable-xa                        \
            --disable-glx-tls                   \
            --with-platforms="drm,x11,wayland" \
            --with-gallium-drivers=$GLL_DRV    \
            --with-dri-drivers=i915,i965,swrast,nouveau,radeon \
            --enable-llvm \
            --enable-gbm \
            --enable-gles1 \
            --enable-gles2 \
            --enable-shared-glapi \
            --enable-dri3 \
            --enable-vdpau \
            --disable-nine
unset GLL_DRV &&
make && make install

#################
# xbitmaps-1.1.2
./configure $XORG_CONFIG
make && make install

##################
# Xorg Applications
cat > app-7.md5 << "EOF"
3b9b79fa0f9928161f4bad94273de7ae  iceauth-1.0.8.tar.bz2
c4a3664e08e5a47c120ff9263ee2f20c  luit-1.1.1.tar.bz2
18c429148c96c2079edda922a2b67632  mkfontdir-1.0.7.tar.bz2
987c438e79f5ddb84a9c5726a1610819  mkfontscale-1.1.3.tar.bz2
e475167a892b589da23edf8edf8c942d  sessreg-1.1.1.tar.bz2
2c47a1b8e268df73963c4eb2316b1a89  setxkbmap-1.3.1.tar.bz2
3a93d9f0859de5d8b65a68a125d48f6a  smproxy-1.0.6.tar.bz2
f0b24e4d8beb622a419e8431e1c03cd7  x11perf-1.6.0.tar.bz2
f3f76cb10f69b571c43893ea6a634aa4  xauth-1.0.10.tar.bz2
d50cf135af04436b9456a5ab7dcf7971  xbacklight-1.2.2.tar.bz2
9956d751ea3ae4538c3ebd07f70736a0  xcmsdb-1.0.5.tar.bz2
b58a87e6cd7145c70346adad551dba48  xcursorgen-1.0.6.tar.bz2
8809037bd48599af55dad81c508b6b39  xdpyinfo-1.3.2.tar.bz2
480e63cd365f03eb2515a6527d5f4ca6  xdriinfo-1.0.6.tar.bz2
249bdde90f01c0d861af52dc8fec379e  xev-1.2.2.tar.bz2
90b4305157c2b966d5180e2ee61262be  xgamma-1.0.6.tar.bz2
f5d490738b148cb7f2fe760f40f92516  xhost-1.0.7.tar.bz2
6a889412eff2e3c1c6bb19146f6fe84c  xinput-1.6.2.tar.bz2
12610df19df2af3797f2c130ee2bce97  xkbcomp-1.4.2.tar.bz2
c747faf1f78f5a5962419f8bdd066501  xkbevd-1.1.4.tar.bz2
502b14843f610af977dffc6cbf2102d5  xkbutils-1.0.4.tar.bz2
938177e4472c346cf031c1aefd8934fc  xkill-1.0.5.tar.bz2
5dcb6e6c4b28c8d7aeb45257f5a72a7d  xlsatoms-1.1.2.tar.bz2
4fa92377e0ddc137cd226a7a87b6b29a  xlsclients-1.1.4.tar.bz2
e50ffae17eeb3943079620cb78f5ce0b  xmessage-1.0.5.tar.bz2
723f02d3a5f98450554556205f0a9497  xmodmap-1.0.9.tar.bz2
eaac255076ea351fd08d76025788d9f9  xpr-1.0.5.tar.bz2
4becb3ddc4674d741487189e4ce3d0b6  xprop-1.2.3.tar.bz2
ebffac98021b8f1dc71da0c1918e9b57  xrandr-1.5.0.tar.bz2
96f9423eab4d0641c70848d665737d2e  xrdb-1.1.1.tar.bz2
c56fa4adbeed1ee5173f464a4c4a61a6  xrefresh-1.0.6.tar.bz2
70ea7bc7bacf1a124b1692605883f620  xset-1.2.4.tar.bz2
5fe769c8777a6e873ed1305e4ce2c353  xsetroot-1.1.2.tar.bz2
558360176b718dee3c39bc0648c0d10c  xvinfo-1.1.3.tar.bz2
11794a8eba6d295a192a8975287fd947  xwd-1.0.7.tar.bz2
9a505b91ae7160bbdec360968d060c83  xwininfo-1.1.4.tar.bz2
79972093bb0766fcd0223b2bd6d11932  xwud-1.0.5.tar.bz2
EOF
mkdir app &&
cd app &&
grep -v '^#' ../app-7.md5 | awk '{print $2}' | wget -i- -c \
    -B https://www.x.org/pub/individual/app/ &&
md5sum -c ../app-7.md5
bash -e
for package in $(grep -v '^#' ../app-7.md5 | awk '{print $2}')
do
  packagedir=${package%.tar.bz2}
  tar -xf $package
  pushd $packagedir
     case $packagedir in
       luit-[0-9]* )
         sed -i -e "/D_XOPEN/s/5/6/" configure && ./configure $XORG_CONFIG
       ;;
       sessreg* )
         ./configure $XORG_CONFIG CFLAGS=" -g -O2 -D_WTMPX_FILE=WTMP_FILE -D_PATH_WTMPX=_PATH_WTMP -D_UTMPX_FILE=UTMP_FILE -D_PATH_UTMPX=_PATH_UTMP" 
       ;;
       * )
         ./configure $XORG_CONFIG
       ;;
     esac
     make -j2
     sudo -S porg -lp $packagedir "make -j1 install"
  popd
  rm -rf $packagedir
done
exit
rm -f $XORG_PREFIX/bin/xkeystone
#*********************************
# sessreg-1.1.1 will not compile:
#sessreg.h:107:21: error: ‘_PATH_WTMPX’ undeclared (first use in this function); did you mean ‘_PATH_WTMP’?
# configure with:
# ./configure $XORG_CONFIG CFLAGS=" -g -O2 -D_WTMPX_FILE=WTMP_FILE -D_PATH_WTMPX=_PATH_WTMP -D_UTMPX_FILE=UTMP_FILE -D_PATH_UTMPX=_PATH_UTMP"
#***************************************************************

#######################
# xcursor-themes-1.0.5
./configure $XORG_CONFIG
make && make install

#######################
# Xorg Fonts
cat > font-7.md5 << "EOF"
23756dab809f9ec5011bb27fb2c3c7d6  font-util-1.3.1.tar.bz2
0f2d6546d514c5cc4ecf78a60657a5c1  encodings-1.0.4.tar.bz2
6d25f64796fef34b53b439c2e9efa562  font-alias-1.0.3.tar.bz2
fcf24554c348df3c689b91596d7f9971  font-adobe-utopia-type1-1.0.4.tar.bz2
e8ca58ea0d3726b94fe9f2c17344be60  font-bh-ttf-1.0.3.tar.bz2
53ed9a42388b7ebb689bdfc374f96a22  font-bh-type1-1.0.3.tar.bz2
bfb2593d2102585f45daa960f43cb3c4  font-ibm-type1-1.0.3.tar.bz2
6306c808f7d7e7d660dfb3859f9091d2  font-misc-ethiopic-1.0.3.tar.bz2
3eeb3fb44690b477d510bbd8f86cf5aa  font-xfree86-type1-1.0.4.tar.bz2
EOF
mkdir font &&
cd font &&
grep -v '^#' ../font-7.md5 | awk '{print $2}' | wget -i- -c \
    -B https://www.x.org/pub/individual/font/ &&
md5sum -c ../font-7.md5
bashe -e
for package in $(grep -v '^#' ../font-7.md5 | awk '{print $2}')
do
  packagedir=${package%.tar.bz2}
  tar -xf $package
  pushd $packagedir
    ./configure $XORG_CONFIG
    make -j2
    sudo -S porg -lp $packagedir "make -j1 install"
  popd
  sudo -S rm -rf $packagedir
done
exit
install -v -d -m755 /usr/share/fonts                               &&
ln -svfn $XORG_PREFIX/share/fonts/X11/OTF /usr/share/fonts/X11-OTF &&
ln -svfn $XORG_PREFIX/share/fonts/X11/TTF /usr/share/fonts/X11-TTF

######################
# XKeyboardConfig-2.24
./configure $XORG_CONFIG --with-xkb-rules-symlink=xorg &&
make && make install

######################
# Pixman-0.34.0
./configure --prefix=/usr --disable-static &&
make && make install

#####################
# libepoxy-1.5.2
./configure --prefix=/usr &&
make && make install

####################
# Removed old proto headers
############################
# xorgproto-2018.4
mkdir build &&
cd    build &&

meson --prefix=$XORG_PREFIX .. &&
ninja
ninja install &&
install -vdm 755 $XORG_PREFIX/share/doc/xorgproto-2018.4 &&
install -vm 644 ../[^m]*.txt ../PM_spec $XORG_PREFIX/share/doc/xorgproto-2018.4

#####################
# Xorg-Server-1.20.0
./configure $XORG_CONFIG            \
           --enable-glamor          \
           --enable-install-setuid  \
           --enable-suid-wrapper    \
           --disable-systemd-logind \
           --with-xkb-output=/var/lib/xkb \
           --enable-kdrive \
           --enable-xwayland
make && make install &&
mkdir -pv /etc/X11/xorg.conf.d

#####################
# Xorg Drivers
# Xorg Intel Driver-20180223
./autogen.sh $XORG_CONFIG     \
            --enable-kms-only \
            --enable-uxa      \
            --mandir=/usr/share/man &&
make && make install &&   
mv -v /usr/share/man/man4/intel-virtual-output.4 \
      /usr/share/man/man1/intel-virtual-output.1 &&
sed -i '/\.TH/s/4/1/' /usr/share/man/man1/intel-virtual-output.1
#############
# libevdev 1.5.9
./configure $XORG_CONFIG &&
make && make install
#############
# mtdev-1.1.5
./configure --prefix=/usr --disable-static &&
make && make install
#############
# Xorg Evdev Driver-2.10.6
./configure $XORG_CONFIG &&
make && make install
#############
# libinput-1.11.0
mkdir build &&
cd    build &&

meson --prefix=$XORG_PREFIX \
      -Dudev-dir=/lib/udev  \
      -Ddebug-gui=false     \
      -Dtests=false         \
      -Ddocumentation=false \
      -Dlibwacom=false      \
      ..                    &&
ninja && ninja install
#############
# Xorg Libinput Driver-0.27.1
./configure $XORG_CONFIG &&
make && make install

#############################
# libva-2.1.0
./configure $XORG_CONFIG &&
make && make install

#############################
# intel-vaapi-driver-2.1.0
./configure $XORG_CONFIG &&
make && make install

############################
# twm-1.0.10
sed -i -e '/^rcdir =/s,^\(rcdir = \).*,\1/etc/X11/app-defaults,' src/Makefile.in &&
./configure $XORG_CONFIG &&
make && make install

########################
# Libutempter-1.1.6
patch -Np1 -i ../libutempter-1.1.6-musl-fix.patch
make && make install

############################
# xterm-333
#sed -i '/v0/{n;s/new:/new:kb=^?:/}' termcap &&
#printf '\tkbs=\\177,\n' >> terminfo &&
#TERMINFO=/usr/share/terminfo \
#./configure $XORG_CONFIG     \
#    --with-app-defaults=/etc/X11/app-defaults &&
#make && make install install-ti
# Will not run(no more pts), recompile with void build:
patch -Np0 -i ../xterm-333-musl-fix.patch 
./configure --enable-wide-chars --enable-88-color --enable-broken-osc \
 --enable-256-color --enable-luit --enable-paste64 --enable-ansi-color \
 --enable-mini-luit --enable-readline-mouse --enable-broken-st \
 --enable-narrowproto --libdir=/etc --enable-load-vt-fonts \
 --with-app-defaults=/usr/share/X11/app-defaults --enable-i18n \
 --disable-full-tgetent --disable-imake --enable-doublechars \
 --enable-freetype --enable-tcap-query --enable-logging --enable-dabbrev \
 --with-pkg-config=yes --enable-exec-xterm --with-utempter
make -j2 && make install install-ti

#############################
# DejaVu Fonts - 2.37
install -v -d -m755 /usr/share/fonts/dejavu &&
install -v -m644 ttf/*.ttf /usr/share/fonts/dejavu &&
fc-cache -v /usr/share/fonts/dejavu

#############################
# xclock-1.0.7
./configure $XORG_CONFIG &&
make && make install

#############################
# xinit-1.4.0
sed -e '/$serverargs $vtarg/ s/serverargs/: #&/' \
    -i startx.cpp
./configure $XORG_CONFIG --with-xinitdir=/etc/X11/app-defaults &&
make && make install
usermod -a -G video <username>

############################
# FriBidi-1.0.4
mkdir build && cd build    &&
meson --prefix=/usr .. &&
ninja && ninja install

###########################
# NASM-2.13.03
./configure --prefix=/usr &&
make &7 make install

###########################
# libjpeg-turbo-1.5.3
./configure --prefix=/usr           \
            --mandir=/usr/share/man \
            --with-jpeg8            \
            --disable-static        \
            --docdir=/usr/share/doc/libjpeg-turbo-1.5.3 &&
make && make install

#########################
# GLU-9.0.0
./configure --prefix=$XORG_PREFIX --disable-static &&
make && make install

########################
# Freeglut-3.0.0
mkdir build && cd    build &&
CMAKE_LIBRARY_PATH=$XORG_PREFIX/lib     \
CMAKE_INCLUDE_PATH=$XORG_PREFIX/include \
cmake -DCMAKE_INSTALL_PREFIX=/usr       \
      -DCMAKE_BUILD_TYPE=Release        \
      -DFREEGLUT_BUILD_DEMOS=OFF        \
      -DFREEGLUT_BUILD_STATIC_LIBS=OFF  \
      .. &&
make && make install

########################
# LibTIFF-4.0.9
# Cmake build wont compile
#mkdir -p libtiff-build &&
#cd       libtiff-build &&
#cmake -DCMAKE_INSTALL_DOCDIR=/usr/share/doc/libtiff-4.0.9 \
#      -DCMAKE_INSTALL_PREFIX=/usr -G Ninja .. &&
#ninja && ninja install
autoreconf -fi
./configure --prefix=/usr \
            --docdir=/usr/share/doc/libtiff-4.0.9
make && make install

#######################
# giflib-5.1.4
./configure --prefix=/usr --disable-static &&
make && make install

#######################
# imlib2-1.5.1
./configure --prefix=/usr --disable-static &&
make && make install

########################
# Fluxbox-1.3.7
./configure --prefix=/usr --disable-nls 
make && make install

########################
# libcap-2.25 with PAM
make -C pam_cap
install -v -m755 pam_cap/pam_cap.so /lib/security &&
install -v -m644 pam_cap/capability.conf /etc/security

######################
# Zsh-5.5.1
./configure --prefix=/usr         \
            --bindir=/bin         \
            --sysconfdir=/etc/zsh \
            --enable-etcdir=/etc/zsh 
make && make install

#####################
# libexif-0.6.21
./configure --prefix=/usr \
            --with-doc-dir=/usr/share/doc/libexif-0.6.21 \
            --disable-static &&
make && make install

###################
# feh-2.26.3
sed -i "s:doc/feh:&-2.26.3:" config.mk &&
make PREFIX=/usr exif=1 && make PREFIX=/usr exif=1 install

###################
# libassuan-2.5.1
./configure --prefix=/usr &&
make && make install

###################
# GPGME-1.11.1
./configure --prefix=/usr --disable-gpg-test &&
make && make install

###################
# Wget-1.19.5
./configure --prefix=/usr      \
            --sysconfdir=/etc  \
            --with-ssl=openssl &&
make && make install

###################
# acpid-2.0.29
./configure --prefix=/usr \
            --docdir=/usr/share/doc/acpid-2.0.29 &&
make && make install
install -v -m755 -d /etc/acpi/events &&
cp -r samples /usr/share/doc/acpid-2.0.29

###################
# pm-utils-1.4.1
./configure --prefix=/usr     \
            --sysconfdir=/etc \
            --docdir=/usr/share/doc/pm-utils-1.4.1 &&
make && make install

###################
# Hdparm-9.56
make && make install

###################
# Wireless Tools-29
patch -Np1 -i ../wireless_tools-29-fix_iwlist_scanning-1.patch
make && make PREFIX=/usr INSTALL_MAN=/usr/share/man install

##################
# ACPI-1.7 [Reader]
./configure --prefix=/usr
make && make install
