# Final System: LibreSSL 2.9.2
# This section is done in Chroot environment
# Source: https://ftp.openbsd.org/pub/OpenBSD/LibreSSL/libressl-2.9.2.tar.gz
# If building Rustc-1.28.0, use LibreSSL-2.7.5 instead

# Apply patches:
patch -Np0 -i ../patches/libressl-2.9.2-void-fail-instead-of-trying-fallback.patch
# restore non-glibc support:
patch -Np1 -i ../patches/libressl-2.9.2-gentoo-musl.patch

# Configure source
case $(uname -m) in
   x86_64) export EXTRACONFIG=""
           ;;
   i686)   export EXTRACONFIG="--disable-hardening"
           ;;
esac
./config --prefix=/usr       \
            --with-openssldir=/etc/ssl $EXTRACONFIG
unset EXTRACONFIG

# Build and install
make && make install

